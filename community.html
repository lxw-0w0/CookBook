<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TastyHub | 美食社区</title>
    <!-- 外部资源 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <!-- 本地样式 -->
    <link rel="stylesheet" href="style-community.css">
</head>
<body>
<nav class="navbar">
    <div class="navbar-container">
        <a class="navbar-brand" href="home.html">
            <i class="bi bi-egg-fried"></i>
            <span>TastyHub</span>
        </a>
        <div class="nav-buttons-group">
            <a class="nav-link nav-btn" href="home.html">首页</a>
            <a class="nav-link nav-btn" href="#" id="publish-post-btn">发布帖子</a>
            <a class="nav-link nav-btn user-nav-btn" href="#" id="my-posts-btn">
                我的帖子
            </a>
            <a class="nav-link nav-btn user-nav-btn" href="#" id="my-comments-btn">
                我的评论
            </a>
            <a class="nav-link nav-btn user-nav-btn" href="#" id="liked-posts-btn">
                收到的赞
                <span class="badge-custom" id="total-likes-badge">0</span>
            </a>
<!-- 头像按钮 + 下拉菜单 -->
<div class="user-avatar-container position-relative">
  <button id="userAvatarBtn" class="btn btn-light rounded-circle p-0" style="width: 40px; height: 40px;">
    <img src="https://picsum.photos/id/237/40/40" class="rounded-circle w-100 h-100" alt="用户头像">
  </button>
  <!-- 下拉菜单（使用类控制显示状态） -->
  <div id="avatarDropdownMenu" class="dropdown-menu position-absolute end-0 mt-2" style="min-width: 150px; z-index: 9999;">
    <button class="dropdown-item" id="change-avatar-btn">
      <i class="bi bi-image"></i> 更换头像
    </button>
    <button class="dropdown-item" id="my-posts-btn">
      <i class="bi bi-file-text"></i> 我的帖子
    </button>
    <button class="dropdown-item" id="my-collection-btn">
      <i class="bi bi-bookmark"></i> 我的收藏
    </button>
    <button class="dropdown-item" id="my-follows-btn">
      <i class="bi bi-people"></i> 我的关注
    </button>
    <button class="dropdown-item" id="liked-posts-btn">
      <i class="bi bi-heart"></i> 收到的赞
    </button>
    <button class="dropdown-item" id="my-comments-btn">
      <i class="bi bi-chat"></i> 我的评论
    </button>
    <div class="dropdown-divider"></div>
    <button class="dropdown-item text-danger" id="logout-btn">
      <i class="bi bi-box-arrow-right"></i> 退出登录
    </button>
  </div>
</div>
</div>
            </div>
        </div>
    </div>
</nav>

<!-- 社区主体 -->
<div class="community-header">
    <h2>美食社区 · 分享你的拿手菜</h2>
    <p>在这里分享你的美食制作心得，发现更多美味食谱，结识志同道合的美食爱好者</p>
</div>

<!-- 搜索栏 -->
<div class="search-bar">
    <i class="bi bi-search search-icon">/</i>
    <input type="text" class="search-input" id="search-input" placeholder="搜索帖子标题/内容...">
</div>

<!-- 分类筛选 -->
<div class="category-filter">
    <button class="btn btn-warning active" data-filter="all">全部帖子</button>
    <button class="btn btn-outline-warning" data-filter="家常菜">家常菜</button>
    <button class="btn btn-outline-warning" data-filter="减脂餐">减脂餐</button>
    <button class="btn btn-outline-warning" data-filter="甜品">甜品</button>
    <button class="btn btn-outline-warning" data-filter="烘焙">烘焙</button>
</div>

<!-- 排序选项 -->
<div class="sort-options">
    <button class="sort-btn active" data-sort="latest">最新发布</button>
    <button class="sort-btn" data-sort="hot">最热帖子</button>
    <button class="sort-btn" data-sort="liked">最多点赞</button>
</div>

<!-- 帖子列表 -->
<div class="posts-container" id="posts-container">
    <div class="empty-posts">
        <i class="bi bi-book">/</i>
        <h4>暂无相关帖子</h4>
        <p>快来发布第一个帖子，分享你的美食故事吧～</p>
        <button class="btn" id="empty-publish-btn">发布帖子</button>
    </div>
</div>
<!-- 我的评论模态框 -->
<div class="modal fade" id="myCommentsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-chat-left text-warning"></i>
                    我的评论
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="modal-stats">
                    <div class="stat-item">
                        <span class="stat-number" id="my-comments-count">0</span>
                        <span class="stat-label">总评论数</span>
                    </div>
                </div>
                <div class="comments-container" id="my-comments-container">
                    <div class="empty-posts">
                        <i class="bi bi-chat-left"></i>
                        <h4>你还没有发布任何评论</h4>
                        <p>快去帖子下方发表你的看法吧～</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 帖子详情弹窗（修复版） -->
<div class="modal fade" id="postDetailModal" tabindex="-1" aria-labelledby="postDetailModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered"> <!-- 新增 modal-dialog-centered 实现居中 -->
    <div class="modal-content" style="border-radius: 15px; overflow: hidden;">
      <div class="modal-header bg-light">
        <h5 class="modal-title" id="postDetailModalLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-0">
        <!-- 帖子图片 -->
        <img id="detailPostImg" class="w-100" style="height: 300px; object-fit: cover;" alt="帖子图片">
        
        <!-- 帖子文案 -->
        <div class="p-4">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="d-flex align-items-center">
              <img src="https://picsum.photos/id/237/40/40" class="rounded-circle me-2" width="40" height="40">
              <span id="detailPostAuthor" class="fw-bold"></span>
            </div>
            <span id="detailPostCategory" class="badge bg-warning text-dark"></span>
          </div>
          <p id="detailPostContent" class="text-muted mb-4"></p>
<!-- 互动按钮（修复后） -->
<div class="d-flex gap-4 mb-4">
  <div class="d-flex align-items-center gap-2 cursor-pointer">
    <span id="detailPostLikes"></span>
  </div>
  <div class="d-flex align-items-center gap-2 cursor-pointer">
    <span id="detailPostCommentsCount"></span>
  </div>
</div>
          <!-- 评论区 -->
          <h6 class="mb-3">评论区</h6>
          <div id="detailCommentsList" class="mb-4">
            <!-- 随机评论会动态生成 -->
          </div>

          <!-- 评论输入框 -->
          <div class="d-flex gap-2">
            <input type="text" id="detailCommentInput" class="form-control rounded-pill" placeholder="输入评论内容...">
            <button id="detailCommentSubmit" class="btn btn-warning rounded-pill">发布</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- 收到的赞模态框 -->
<div class="modal fade" id="likedPostsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    收到的赞
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="modal-stats">
                    <div class="stat-item">
                        <span class="stat-number" id="total-likes-count">0</span>
                        <span class="stat-label">总获赞数</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="liked-posts-count">0</span>
                        <span class="stat-label">被点赞的帖子数</span>
                    </div>
                </div>
                <div class="posts-container" id="liked-posts-container">
                    <div class="empty-posts">
                        <h4>你的帖子还没有收到点赞</h4>
                        <p>发布更多优质内容，获得更多点赞吧～</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 发布帖子模态框 -->
<div class="modal fade" id="publishPostModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">发布美食帖子</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">帖子标题</label>
                    <input type="text" class="form-control" id="post-title" placeholder="比如：我的秘制红烧肉">
                    <div class="form-error" id="title-error">请输入帖子标题</div>
                </div>
                <div class="mb-3">
                    <label class="form-label">分类</label>
                    <select class="form-select" id="post-category">
                        <option value="家常菜">家常菜</option>
                        <option value="减脂餐">减脂餐</option>
                        <option value="甜品">甜品</option>
                        <option value="烘焙">烘焙</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">内容</label>
                    <textarea class="form-control" id="post-content" rows="4" placeholder="分享你的制作步骤、心得..."></textarea>
                    <div class="form-error" id="content-error">请输入帖子内容</div>
                </div>
                <div class="mb-3">
                    <label class="form-label">上传图片</label>
                    <input type="file" class="form-control" id="post-img" accept="image/*">
                    <div class="form-error" id="img-error">请上传帖子图片</div>
                    <img id="post-img-preview" alt="预览图">
                    <small class="text-muted mt-2 d-block">建议上传清晰的美食图片，尺寸比例1:1效果更佳</small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button class="btn btn-warning" id="submit-post">发布</button>
            </div>
        </div>
    </div>
</div>

<!-- 图片预览模态框 -->
<div class="modal fade" id="imagePreviewModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
            <div class="modal-header bg-black bg-opacity-75">
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body d-flex justify-content-center align-items-center bg-black">
                <img id="previewImage" class="img-fluid" alt="图片预览">
            </div>
        </div>
    </div>
</div>
<!-- 头像上传模态框 -->
<div class="modal fade" id="avatarUploadModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-person-circle text-warning"></i> 更换头像
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="avatar-preview mx-auto mb-3" style="width: 120px; height: 120px; border-radius: 50%; overflow: hidden; border: 2px solid #ffc107;">
                    <img id="avatarPreviewImg" src="" alt="预览头像" class="w-100 h-100 object-cover">
                </div>
                <input type="file" class="form-control" id="avatarFileInput" accept="image/*">
                <small class="text-muted d-block mt-2">支持 JPG/PNG 格式，建议尺寸 1:1</small>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button class="btn btn-warning" id="saveAvatarBtn">保存头像</button>
            </div>
        </div>
    </div>
</div>

<!-- 我的收藏模态框 -->
<div class="modal fade" id="myCollectionModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-bookmark-heart-fill text-warning"></i> 我的收藏
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="modal-stats mb-4">
                    <div class="stat-item">
                        <span class="stat-number" id="collection-count">0</span>
                        <span class="stat-label">收藏的帖子数</span>
                    </div>
                </div>
                <div class="posts-container" id="collection-container">
                    <div class="empty-posts">
                        <i class="bi bi-bookmark-heart"></i>
                        <h4>暂无收藏的帖子</h4>
                        <p>遇到喜欢的食谱，记得点击收藏哦～</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 我的关注模态框 -->
<div class="modal fade" id="followListModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-people-fill text-warning"></i> 我的关注
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="modal-stats mb-4">
                    <div class="stat-item">
                        <span class="stat-number" id="follow-count">0</span>
                        <span class="stat-label">关注的博主数</span>
                    </div>
                </div>
                <div id="follow-list">
                    <div class="empty-posts">
                        <i class="bi bi-people"></i>
                        <h4>暂无关注的博主</h4>
                        <p>关注喜欢的美食博主，第一时间获取新内容～</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 点赞列表模态框 -->
<div class="modal fade" id="likeListModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-heart-fill text-danger"></i> 点赞列表
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="like-list-container">
                    <div class="empty-posts">
                        <i class="bi bi-heart"></i>
                        <h4>暂无点赞用户</h4>
                        <p>该帖子还没有收到点赞～</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 帖子编辑模态框 -->
<div class="modal fade" id="editPostModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-pencil text-warning"></i> 编辑帖子
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-post-id">
                <div class="mb-3">
                    <label class="form-label">帖子标题</label>
                    <input type="text" class="form-control" id="edit-post-title" placeholder="比如：我的秘制红烧肉">
                    <div class="form-error" id="edit-title-error">请输入帖子标题</div>
                </div>
                <div class="mb-3">
                    <label class="form-label">分类</label>
                    <select class="form-select" id="edit-post-category">
                        <option value="家常菜">家常菜</option>
                        <option value="减脂餐">减脂餐</option>
                        <option value="甜品">甜品</option>
                        <option value="烘焙">烘焙</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">内容</label>
                    <textarea class="form-control" id="edit-post-content" rows="4" placeholder="分享你的制作步骤、心得..."></textarea>
                    <div class="form-error" id="edit-content-error">请输入帖子内容</div>
                </div>
                <div class="mb-3">
                    <label class="form-label">更换图片</label>
                    <input type="file" class="form-control" id="edit-post-img" accept="image/*">
                    <img id="edit-post-img-preview" alt="预览图" class="mt-2">
                    <small class="text-muted mt-2 d-block">建议上传清晰的美食图片，尺寸比例1:1效果更佳</small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button class="btn btn-warning" id="submit-edit-post">保存修改</button>
            </div>
        </div>
    </div>
</div>

<!-- 回到顶部按钮 -->
<div class="back-to-top" id="back-to-top">
    <i class="bi bi-arrow-up"></i>
</div>

<!-- 外部脚本 -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- 本地脚本 -->
<script src="script-community.js"></script>
</body>
</html>